--// Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Forsaken | AutoBlock",
   LoadingTitle = "Forsaken Utility",
   LoadingSubtitle = "by ChatGPT",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "ForsakenScripts",
      FileName = "AutoBlockConfig"
   },
   KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458) -- Sword icon
local Section = MainTab:CreateSection("Auto Block")

-- Toggle state
getgenv().AutoBlock = false
getgenv().DetectionRange = 15 -- default studs

-- Auto Block toggle
MainTab:CreateToggle({
   Name = "Auto Block",
   CurrentValue = false,
   Flag = "AutoBlockToggle",
   Callback = function(Value)
      getgenv().AutoBlock = Value
   end,
})

-- Detection Range dropdown
MainTab:CreateDropdown({
   Name = "Detection Range",
   Options = {"15","25","50","75","100"},
   CurrentOption = "15",
   Flag = "DetectionRange",
   Callback = function(Option)
      getgenv().DetectionRange = tonumber(Option)
   end,
})

-- Killer Attack Animations (full list)
local BlockAnimations = {
    "126830014841198", "126355327951215", "121086746534252", "18885909645",
    "98456918873918", "105458270463374", "83829782357897", "125403313786645",
    "118298475669935", "82113744478546", "70371667919898", "99135633258223",
    "97167027849946", "109230267448394", "139835501033932", "126896426760253",
    "109667959938617", "126681776859538", "129976080405072", "121293883585738",
    "81639435858902", "137314737492715", "92173139187970"
}

--// Auto Block Logic (No cooldown timer)
task.spawn(function()
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")

   RunService.Heartbeat:Connect(function()
      if getgenv().AutoBlock and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
         for _,plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") then
               local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
               local root = plr.Character:FindFirstChild("HumanoidRootPart")

               if humanoid and humanoid:FindFirstChild("Animator") and root then
                  local distance = (root.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                  if distance <= getgenv().DetectionRange then
                     for _,track in ipairs(humanoid.Animator:GetPlayingAnimationTracks()) do
                        local animId = tostring(track.Animation.AnimationId):gsub("%D", "")
                        if table.find(BlockAnimations, animId) then
                           -- Fire block immediately
                           local args = {"UseActorAbility","Block"}
                           game:GetService("ReplicatedStorage")
                              :WaitForChild("Modules")
                              :WaitForChild("Network")
                              :WaitForChild("RemoteEvent")
                              :FireServer(unpack(args))
                        end
                     end
                  end
               end
            end
         end
      end
   end)
end)
